# Development overrides for docker-compose.yml
services:
  backend:
    volumes:
      # Mount source code for hot reload during development
      - ./src/backend:/app/src/backend:delegated
      - ./requirements.txt:/app/requirements.txt:ro
      # Mount local data directories (using correct paths)
      - ./data/chroma_db:/app/data/chroma_db
      - ./cache/transformers:/app/cache/transformers
      - ./logs:/app/logs
    environment:
      # Development environment variables
      - DEBUG=true
      - LOG_LEVEL=DEBUG
      - RELOAD=true
      - TRANSFORMERS_OFFLINE=0
      - HF_DATASETS_OFFLINE=0
    ports:
      # Expose additional ports for debugging
      - "8000:8000"
      - "5678:5678"  # debugpy port
    command: >
      sh -c "pip install debugpy &&
             python -m debugpy --listen 0.0.0.0:5678 --wait-for-client
             -m uvicorn src.backend.main:app --host 0.0.0.0 --port 8000 --reload"

  frontend:
    volumes:
      # Mount source code for hot reload
      - ./src/frontend:/app:delegated
      - /app/node_modules  # Use container's node_modules
    environment:
      - NODE_ENV=development
      - CHOKIDAR_USEPOLLING=true  # For Windows file watching
      - VITE_HMR_PORT=3000
    stdin_open: true
    tty: true

  postgres:
    ports:
      - "5432:5432"
    volumes:
      # Mount local data for persistence during development
      - ./data/postgres:/var/lib/postgresql/data

  chroma:
    volumes:
      # Mount local data for persistence during development
      - ./data/chroma_db:/chroma/chroma

  # Redis service not currently configured in main docker-compose.yml 